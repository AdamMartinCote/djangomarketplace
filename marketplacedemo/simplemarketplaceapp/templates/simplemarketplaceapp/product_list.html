{% extends 'simplemarketplaceapp/base.html' %}
{% block content %}
<main>
	<h2>Product list:</h2>
	<div class="product-list">
		<ul>
			<table>
				{% if product_list %}
				<tr>
					<th>product name</th>
					<th>product price</th>
					<th>inventory</th>
					<th>purchase</th>
				</tr>
				{% else %}
				<p>No product available</p>
				{% endif %}
				{% for product in product_list %}
				<tr>
					<td>{{ product.title }}</td>
					<td>{{ product.price }}</td>
					<td>{{ product.inventory_count }}</td>
					<td>
						<a href="{% url 'detail' product.id %}">
							<button {% if product.inventory_count < 1 %} disabled {% endif %}>
								Purchase now
							</button>
						</a>
					</td>
				</tr>
				{% endfor %}
			</table>
		</ul>
	</div>

	<form method="GET" action="" id="searchform">
		<h3>filter search:</h3>
		<input class="searchfield" id="searchbox" name="filter"
					 type="text" value="{{ request.GET.filter }}" placeholder="narrow search..."/>
		<label>
			<input type="checkbox" name="onlyAvailable" value="onlyAvailable"
						 {% if request.GET.onlyAvailable %} checked {% endif %}>Available only</label>
			<button>Seach</button>
	</form>

	<script>
	 window.onload = function () {
     if (typeof history.pushState === "function") {
       history.pushState("jibberish", null, null);
       window.onpopstate = function () {
         history.pushState('newjibberish', null, null);
         // Handle the back (or forward) buttons here
         // Will NOT handle refresh, use onbeforeunload for this.
       };
     }
     else {
       var ignoreHashChange = true;
       window.onhashchange = function () {
         if (!ignoreHashChange) {
           ignoreHashChange = true;
           window.location.hash = Math.random();
           // Detect and redirect change here
           // Works in older FF and IE9
           // * it does mess with your hash symbol (anchor?) pound sign
           // delimiter on the end of the URL
         }
         else {
           ignoreHashChange = false;
         }
       };
     }
	 }
	</script>
</main>
</body>
{% endblock %}
